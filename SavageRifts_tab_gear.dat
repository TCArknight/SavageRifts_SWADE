<?xml version="1.0" encoding="UTF-8"?>

<!-- This file contains the definition of the "Gear" tab panel. This tab is where
      the user selects general gear (non-weapons) for the character.

      All public visual elements used with this tab panel start with the prefix "gr" to associate them with the tab.
-->

<document signature="Hero Lab Data">


  <!-- grGearSRA portal
        Presents a dynamic table where the user can add gear for the character.

        We use separate templates for selecting gear and showing the gear that has
        been chosen. Each of these appears further below.

        We use an "additem" script to simply prompt the user to add gear.

        The "buytemplate" and "selltemplate" attributes hook in the logic for
        properly buying and selling gear for cash.

        We use a "headertitle" script to place a suitable title above the table.

        The "list" tag expression restricts everything to only equipment (e.g. no
        weapons). The "candidate" tag expression is omitted, resulting in the same
        contents as the "list" tag expression.
  -->
  <portal
    id="grGearSRA"
    style="tblNormal">
    <table_dynamic
      component="Gear"
      showtemplate="grGearPickSRA"
      choosetemplate="grGearThingSRA"
      choosesortset="Gear"
      buytemplate="BuyCash"
      selltemplate="SellCash"
      columns="2"
      descwidth="275">
      <list>component.Equipment &amp; !component.MagicItem &amp; !GearType.Robots</list>
      <titlebar><![CDATA[
        @text = "Select Gear to Purchase from the List Below"
        ]]></titlebar>
      <headertitle><![CDATA[
        @text = "Miscellaneous Gear"
        ]]></headertitle>
      <additem><![CDATA[
        @text = "Add New Gear"
        ]]></additem>
      </table_dynamic>
    </portal>


  <!-- grGizmosSRA portal
        Presents a dynamic table where the user can add and adjust shared gizmos for
        the character. The tag "Helper.Foreign" is always assigned to indicate that
        the power is to be handled as a foreign weird science gizmo. In all other
        respects, except the text shown, this portal behaves the same as "apPowers".
  -->
  <portal
    id="grGizmosSRA"
    style="tblNormal">
    <table_dynamic
      component="Power"
      showtemplate="apPower"
      choosetemplate="SimpleItem"
      descwidth="350">
      <list>Helper.Foreign</list>
      <candidate/>
      <autotag group="Helper" tag="Foreign"/>
      <titlebar><![CDATA[
        @text = "Add a Borrowed Weird Science Gizmo"
        ]]></titlebar>
      <description/>
      <headertitle><![CDATA[
        @text = "Borrowed Weird Science Gizmos"
        ]]></headertitle>
      <additem><![CDATA[
        @text = "Add a Borrowed Weird Science Gizmo"
        ]]></additem>
      </table_dynamic>
    </portal>


  <!-- grVehicleSRA portal
        Presents a dynamic table where the user can add vehicles for the character.

        We use separate templates for selecting vehicles and showing the vehicles
        that have been chosen. Each of these appears further below.

        We use an "additem" script to simply prompt the user to add vehicles.

        The "buytemplate" and "selltemplate" attributes hook in the logic for
        properly buying and selling vehicles for cash.

        We use a "headertitle" script to place a suitable title above the table.

        The "list" tag expression restricts everything to only vehicles (e.g. no
        weapons). The "candidate" tag expression is omitted, resulting in the same
        contents as the "list" tag expression.
  -->
  <portal
    id="grVehicleSRA"
    style="tblNormal">
    <table_dynamic
      component="Gear"
      showtemplate="grVehPickSRA"
      showsortset="Vehicle"
      choosetemplate="grVehThingSRA"
      choosesortset="Vehicle"
      buytemplate="BuyCash"
      selltemplate="SellCash"
      descwidth="300">
      <list>component.Vehicle &amp; !component.Starship &amp; !component.Walker &amp; !component.PowerAr</list>
      <titlebar><![CDATA[
        @text = "Select Vehicles to Purchase from the List Below"
        ]]></titlebar>
      <headertitle><![CDATA[
        @text = "Miscellaneous Vehicles"
        ]]></headertitle>
      <additem><![CDATA[
        @text = "Add New Vehicle"
        ]]></additem>
      </table_dynamic>
    </portal>

  <portal
    id="grWalkerSRA"
    style="tblNormal">
    <table_dynamic
      component="Gear"
      showtemplate="grWalkerPickSRA"
      choosetemplate="arWalkerThingSRA"
      choosesortset="VehicleType"
      buytemplate="BuyCash"
      selltemplate="SellCash"
      descwidth="350">
      <list>component.Walker</list>
      <titlebar><![CDATA[
        @text = "Select Robot Vehicle to Purchase from the List Below"
        ]]></titlebar>
      <headertitle><![CDATA[
        @text = "Robot Vehicle"
        ]]></headertitle>
      <additem><![CDATA[
        @text = "Add New Robot Vehicle"
        ]]></additem>
      </table_dynamic>
    </portal>


   <portal
    id="grBotsSRA"
    style="tblNormal">
    <table_dynamic
      component="Gear"
      showtemplate="sfRoboPick"
      choosetemplate="sfRoThing"
      buytemplate="BuyCash"
      selltemplate="SellCash"
      descwidth="350">
      <list>component.Robot</list>
      <titlebar><![CDATA[
        @text = "Add a Bot"
        ]]></titlebar>
      <description/>
      <headertitle><![CDATA[
        @text = "Bots"
        ]]></headertitle>
      <additem><![CDATA[
        @text = "Add New Bot"
        ]]></additem>
      </table_dynamic>
    </portal>
	
  <!-- grGearThingSRA template
        Derived from the SimpleItem template, this includes the purchase cost and
        the lotsize of the item to be purchased.
  -->
  <template
    id="grGearThingSRA"
    name="Gear Thing"
    compset="Equipment"
    marginhorz="3"
    marginvert="2">

    <portal
      id="name"
      style="lblLeft">
      <label>
        <labeltext><![CDATA[
          @text = field[name].text
          if (field[lotsize].value > 1) then
            @text &= " (x" & field[lotsize].text & ")"
            endif
          ]]></labeltext>
        </label>
      </portal>

    <portal
      id="cost"
      style="lblNormal">
      <label>
        <labeltext><![CDATA[
          @text = field[grCost].text
          ]]></labeltext>
        </label>
      </portal>

    <position><![CDATA[
      ~set up our dimensions, with a width that we dictate
      height = portal[name].height
      width = 250

      ~if this is a "sizing" calculation, we're done
      doneif (issizing <> 0)

      ~if this is a show-only thing, hide the cost, then position the name
      if (tagis[thing.showonly] <> 0) then
        perform portal[name].setstyle[lblNormal]
        portal[cost].visible = 0
        portal[name].width = width
        done
        endif

      ~position the cost portal on the far right
      perform portal[cost].alignedge[right,0]

      ~position the name on the left and let it use all available space
      portal[name].left = 0
      portal[name].width = minimum(portal[name].width,portal[cost].left - 10)
      ~shrink the name to fit the available space if it's too big, then re-center
      perform portal[name].sizetofit[30]
      perform portal[name].centervert
      ]]></position>

    </template>


  <!-- grGearPickSRA template
        Derived from the SimpleItem template, this includes the gear button to move
        equipment between various containers.
  -->
  <template
    id="grGearPickSRA"
    name="Gear Pick"
    compset="Equipment"
    marginhorz="2"
    marginvert="3">

    <portal
      id="name"
      style="lblLeft"
      showinvalid="yes">
      <label
        field="grStkName">
        </label>
      </portal>

    <portal
      id="namecheck"
      style="chkNormal"
      showinvalid="yes"
      tiptext="Click to equip this gear.">
      <checkbox
        field="grIsEquip"
        dynamicfield="grStkName">
        </checkbox>
      </portal>

    <portal
      id="username"
      style="editNormal">
      <edit
        field="grUserName"
        maxlength="100">
        </edit>
      </portal>

    <portal
      id="container"
      style="imgNormal">
      <image_literal
        image="container.bmp"
        isbuiltin="yes"
        istransparent="yes">
        </image_literal>
      <mouseinfo><![CDATA[
        call InfoHolder
        ]]></mouseinfo>
      </portal>

    <portal
      id="heldby"
      style="imgNormal">
      <image_literal
        image="gearinfo.bmp"
        isbuiltin="yes"
        istransparent="yes">
        </image_literal>
      <mouseinfo><![CDATA[
        call InfoHeld
        ]]></mouseinfo>
      </portal>

    <portal
      id="gearmanage"
      style="actGear"
      tiptext="Click here to choose which container to place this equipment within.">
      <action
        action="gear">
        </action>
      </portal>

    <portal
      id="info"
      style="actInfo">
      <action
        action="info">
        </action>
      <mouseinfo/>
      </portal>

    <portal
      id="delete"
      style="actDelete"
      tiptext="Click to delete this equipment">
      <action
        action="delete">
        </action>
      </portal>

    <position><![CDATA[
      ~set up our height based on our tallest portal
      height = portal[info].height

      ~if this is a "sizing" calculation, we're done
      doneif (issizing <> 0)

      ~determine whether the container and heldby indicators should be visible
      portal[container].visible = tagis[thing.holder?]
      portal[heldby].visible = isgearheld

      ~center the portals vertically
      perform portal[info].centervert
      perform portal[name].centervert
      perform portal[namecheck].centervert
      perform portal[username].centervert
      perform portal[gearmanage].centervert
      perform portal[delete].centervert
      perform portal[container].centervert
      perform portal[heldby].centervert

      ~determine if it's equippable and needs a checkbox
      if (tagis[Equipped.Equippable] = 0) then
        portal[namecheck].visible = 0
      else
        portal[name].visible = 0
        endif

      ~position the delete portal on the far right
      perform portal[delete].alignedge[right,0]

      ~position the info portal to the left of the delete button
      perform portal[info].alignrel[rtol,delete,-2]

      ~position the gear portal to the left of the info button
      perform portal[gearmanage].alignrel[rtol,info,-2]

      ~calculate the space to reserve for the various indicators
      var reserve as number
      if (portal[heldby].visible <> 0) then
        reserve += portal[heldby].width + 2
        endif
      if (portal[container].visible <> 0) then
        reserve += portal[container].width + 2
        endif
      if (portal[heldby].visible + portal[container].visible <> 0) then
        reserve += 3
        endif

      ~position the name on the left and let it use all available space
      var limit as number
      limit = portal[gearmanage].left - 8 - reserve
      portal[name].left = 0
      portal[name].width = minimum(portal[name].width,limit)
      portal[namecheck].width = minimum(portal[namecheck].width,limit)

      ~if this is a "custom" gear pick, show an edit portal instead of the name
      var nextleft as number
      if (tagis[Equipment.CustomGear] <> 0) then
        portal[name].visible = 0
        portal[username].left = portal[name].left
        portal[username].width = minimum(200,limit)
        nextleft = portal[username].right
      else
        portal[username].visible = 0
        nextleft = portal[name].right
        endif
      nextleft += 5

      ~show the 'container' icon to the right of the name (if visible)
      if (portal[container].visible <> 0) then
        portal[container].left = nextleft
        nextleft = portal[container].right + 2
        endif

      ~show the 'held by' icon to the right of the container icon (if visible)
      if (portal[heldby].visible <> 0) then
        portal[heldby].left = nextleft
        endif

      ~shrink the name to fit the available space if it's too big, then re-center
      perform portal[name].sizetofit[30]
      perform portal[name].centervert
      perform portal[namecheck].sizetofit[30]
      perform portal[namecheck].centervert

      ~if the gear can't be deleted (i.e. it's been auto-added instead of user-added,
      ~set the style to indicate that behavior to the user
      if (candelete = 0) then
        perform portal[name].setstyle[lblAuto]
        endif
      ]]></position>

    </template>

	
  <!-- HGThingRIFTS template
        Derived from the SimpleItem template, this includes the purchase cost of
        the vehicle to be purchased.
  -->
  <template
    id="arWalkerThingSRA"
    name="Robot Vehicle Thing"
    compset="Walker"
    marginhorz="3"
    marginvert="2">

    <portal
      id="name"
      style="lblNormal">
      <label field="name">
        </label>
      </portal>

    <portal
      id="cost"
      style="lblNormal">
      <label>
        <labeltext><![CDATA[
          @text = field[grCost].text
          ]]></labeltext>
        </label>
      </portal>

    <position><![CDATA[
      ~set up our dimensions, with a width that we dictate
      height = portal[name].height
      width = 250

      ~if this is a "sizing" calculation, we're done
      doneif (issizing <> 0)

      if (tagis[thing.showonly] <> 0) then
        portal[cost].visible = 0
        portal[name].width = width
        done
        endif

      ~position the cost portal on the far right
      perform portal[cost].alignedge[right,0]

      ~position the name on the left and let it use all available space
      portal[name].left = 0
      portal[name].width = minimum(portal[name].width,portal[cost].left - 10)
      ]]></position>

    </template>

  <!-- sfWaPick template
        Derived from the SimpleItem template, this includes the gear button to move
        equipment between various containers.
  -->
  <template
    id="grWalkerPickSRA"
    name="Walker Pick"
    compset="Walker"
    marginhorz="3"
    marginvert="3">

    <portal
      id="name"
      style="chkNormal"
      showinvalid="yes"
      tiptext="Click to pilot this vehicle">
      <checkbox
        field="grIsEquip"
        dynamicfield="grStkName">
        </checkbox>
      </portal>

    <portal
      id="container"
      style="imgNormal">
      <image_literal
        image="container.bmp"
        isbuiltin="yes"
        istransparent="yes">
        </image_literal>
      <mouseinfo><![CDATA[
        call InfoHolder
        ]]></mouseinfo>
      </portal>

    <portal
      id="info"
      style="actInfo">
      <action
        action="info">
        </action>
      <mouseinfo><![CDATA[
        var mouseinfo as string
        call MouseInfoSRA
        @text = mouseinfo
        ]]></mouseinfo>
      </portal>
	  
    <portal
      id="edit"
      style="actEdit"
      tiptext="Click here to edit the entry.">
      <action
        action="edit">
        </action>
      </portal>

    <portal
      id="delete"
      style="actDelete"
      tiptext="Click to delete this vehicle">
      <action
        action="delete">
        </action>
      </portal>

    <position><![CDATA[
      ~set up our height based on our tallest portal
      height = portal[info].height

      ~if this is a "sizing" calculation, we're done
      doneif (issizing <> 0)

      ~center the portals vertically
      perform portal[info].centervert
      perform portal[name].centervert
      perform portal[delete].centervert
      perform portal[container].centervert
      perform portal[edit].centervert

      ~position the delete portal on the far right
      perform portal[delete].alignedge[right,0]

      ~position the info portal to the left of the delete button
      perform portal[info].alignrel[rtol,delete,-8]

      ~position the edit portal to the left of the info button
      perform portal[edit].alignrel[rtol,info,-8]

      ~show the 'container' icon to the left of the edit button
      perform portal[container].alignrel[rtol,info,-32]

      ~position the name on the left and position the user-fillable name field next to it
      var limit as number
      portal[name].left = 0

      ]]></position>

    </template>

  <!-- grVehThingSRA template
        Derived from the SimpleItem template, this includes the purchase cost of
        the vehicle to be purchased.
  -->
  <template
    id="grVehThingSRA"
    name="Vehicle Thing"
    compset="Vehicle"
    marginhorz="3"
    marginvert="2">

    <portal
      id="name"
      style="lblNormal">
      <label field="name">
        </label>
      </portal>

    <portal
      id="cost"
      style="lblNormal">
      <label>
        <labeltext><![CDATA[
          @text = field[grCost].text
          ]]></labeltext>
        </label>
      </portal>

    <position><![CDATA[
      ~set up our dimensions, with a width that we dictate
      height = portal[name].height
      width = 250

      ~if this is a "sizing" calculation, we're done
      doneif (issizing <> 0)

      ~if this is a show-only thing, hide the cost, then position the name
      if (tagis[thing.showonly] <> 0) then
        portal[cost].visible = 0
        portal[name].width = width
        done
        endif

      ~position the cost portal on the far right
      perform portal[cost].alignedge[right,0]

      ~position the name on the left and let it use all available space
      portal[name].left = 0
      portal[name].width = minimum(portal[name].width,portal[cost].left - 10)
      ]]></position>

    </template>


  <!-- grVehPickSRA template
        Derived from the SimpleItem template, this includes the gear button to move
        equipment between various containers.
  -->
  <template
    id="grVehPickSRA"
    name="Vehicle Pick"
    compset="Vehicle"
    marginhorz="3"
    marginvert="3">

    <portal
      id="name"
      style="lblNormal"
      showinvalid="yes">
      <label
        field="name">
        </label>
      </portal>

    <portal
      id="container"
      style="imgNormal">
      <image_literal
        image="container.bmp"
        isbuiltin="yes"
        istransparent="yes">
        </image_literal>
      <mouseinfo><![CDATA[
        call InfoHolder
        ]]></mouseinfo>
      </portal>

    <portal
      id="info"
      style="actInfo">
      <action
        action="info">
        </action>
      <mouseinfo><![CDATA[
        var mouseinfo as string
        call MouseInfoSRA
        @text = mouseinfo
        ]]></mouseinfo>
      </portal>

    <portal
      id="delete"
      style="actDelete"
      tiptext="Click to delete this vehicle">
      <action
        action="delete">
        </action>
      </portal>

    <!-- RDS SFC Added the ability to edit the LoadOut for Vehicles to manage vehicle Modifications -->
    <portal
      id="edit"
      style="actEdit"
      tiptext="Click here to edit the entry.">
      <action
        action="edit">
        </action>
      </portal>

    <position><![CDATA[
      ~set up our height based on our tallest portal
      height = portal[info].height

      ~if this is a "sizing" calculation, we're done
      doneif (issizing <> 0)

      ~center the portals vertically
      perform portal[info].centervert
      perform portal[name].centervert
      perform portal[delete].centervert
      perform portal[container].centervert
      perform portal[edit].centervert

      ~position the delete portal on the far right
      perform portal[delete].alignedge[right,0]

      ~position the info portal to the left of the delete button
      perform portal[info].alignrel[rtol,delete,-8]

      ~position the edit portal to the left of the info button
      perform portal[edit].alignrel[rtol,info,-8]

      ~show the 'container' icon to the left of the edit button
      perform portal[container].alignrel[rtol,info,-32]

      ~position the name on the left
      var limit as number
      portal[name].left = 0
      ~shrink the name to fit the available space if it's too big, then re-center
      perform portal[name].sizetofit[30]
      perform portal[name].centervert

      ~if the gear can't be deleted (i.e. it's been auto-added instead of user-added,
      ~set the style to indicate that behavior to the user
      if (candelete = 0) then
        perform portal[name].setstyle[lblAuto]
        endif
      ]]></position>

    </template>


  <!-- gear layout
        This layout orchestrates the display of the visual elements that comprise
        the Gear tab. This amounts to a title and a table that allow the user to
        add gear to the character.

        The logic for this layout is similar to preceeding tabs, so please refer
        to those tabs for more details.
  -->
  <layout
    id="gearSRA">
    <portalref portal="grGearSRA" taborder="10"/>
    <portalref portal="grGizmosSRA" taborder="20"/>
    <portalref portal="grVehicleSRA" taborder="30"/>
    <portalref portal="grWalkerSRA" taborder="30"/>
    <portalref portal="grBotsSRA" taborder="40"/>

    <!-- This script sizes and positions the layout and its child visual elements. -->
    <position><![CDATA[
	  autogap = 10
	  
      ~set all tables to span the full width of the layout
      portal[grGearSRA].width = width
      portal[grGizmosSRA].width = width
      portal[grVehicleSRA].width = width
      portal[grWalkerSRA].width = width
      portal[grBotsSRA].width = width

      perform portal[grGearSRA].batchadd
      perform portal[grGizmosSRA].batchadd
      perform portal[grVehicleSRA].batchadd
      perform portal[grWalkerSRA].batchadd
      perform portal[grBotsSRA].batchadd

      perform this.batchplace
      ]]></position>

    </layout>


  <!-- gear panel
        This is the "Gear" panel shown within Hero Lab. Since we want this panel to
        appear second within the second grouping (equipment), we assign it an
        "order" of 220.

        The logic for this panel is similar to the logic for the preceeding panels,
        so please refer to those panels for more details.
  -->
  <panel
    id="gearSRA"
    name="Gear"
    marginhorz="5"
    marginvert="5"
    order="220">
    <live>source.srcRiftsTLPGAE</live>
    <layoutref layout="gearSRA"/>
    <position><![CDATA[
      ]]></position>
    </panel>


  </document>
